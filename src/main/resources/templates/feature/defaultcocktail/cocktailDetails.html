<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link th:href="@{/css/fragment/navbar-fragment.css}" rel="stylesheet">
    <link th:href="@{/css/defaultcocktail/defaultcocktail.css}" rel="stylesheet">
    <title th:text="${cocktail.isPresent() ? cocktail.get().strDrink : '칵테일 상세 정보'}">칵테일 상세 정보</title>
</head>
<body>
<div th:replace="~{fragment/navbar-fragment :: navbarFragment}"></div>

<hr class="divider">

<div th:if="${cocktail.isPresent()}" class="cocktail-details">
    <h1 th:text="${cocktail.get().strDrink}">칵테일 이름</h1>
    <h1 class="default-cocktail-number" th:text="${cocktail.get().getId()}" style="display: none" >칵테일 번호</h1>
    <p><strong>종류:</strong> <span th:text="${cocktail.get().strAlcoholic}"></span></p>
    <p><strong>카테고리:</strong> <span th:text="${cocktail.get().strCategory}"></span></p>
    <p><strong>잔 종류:</strong> <span th:text="${cocktail.get().strGlass}"></span></p>


    <h2>재료:</h2>
    <ul class="ingredient-list">
        <li th:if="${cocktail.get().strIngredient1 != null and !cocktail.get().strIngredient1.isEmpty()}"
            th:text="${cocktail.get().strIngredient1 + (cocktail.get().strMeasure1 != null and !cocktail.get().strMeasure1.isEmpty() ? ' - ' + cocktail.get().strMeasure1 : '')}"></li>
        <li th:if="${cocktail.get().strIngredient2 != null and !cocktail.get().strIngredient2.isEmpty()}"
            th:text="${cocktail.get().strIngredient2 + (cocktail.get().strMeasure2 != null and !cocktail.get().strMeasure2.isEmpty() ? ' - ' + cocktail.get().strMeasure2 : '')}"></li>
        <li th:if="${cocktail.get().strIngredient3 != null and !cocktail.get().strIngredient3.isEmpty()}"
            th:text="${cocktail.get().strIngredient3 + (cocktail.get().strMeasure3 != null and !cocktail.get().strMeasure3.isEmpty() ? ' - ' + cocktail.get().strMeasure3 : '')}"></li>
        <li th:if="${cocktail.get().strIngredient4 != null and !cocktail.get().strIngredient4.isEmpty()}"
            th:text="${cocktail.get().strIngredient4 + (cocktail.get().strMeasure4 != null and !cocktail.get().strMeasure4.isEmpty() ? ' - ' + cocktail.get().strMeasure4 : '')}"></li>
        <li th:if="${cocktail.get().strIngredient5 != null and !cocktail.get().strIngredient5.isEmpty()}"
            th:text="${cocktail.get().strIngredient5 + (cocktail.get().strMeasure5 != null and !cocktail.get().strMeasure5.isEmpty() ? ' - ' + cocktail.get().strMeasure5 : '')}"></li>
        <li th:if="${cocktail.get().strIngredient6 != null and !cocktail.get().strIngredient6.isEmpty()}"
            th:text="${cocktail.get().strIngredient6 + (cocktail.get().strMeasure6 != null and !cocktail.get().strMeasure6.isEmpty() ? ' - ' + cocktail.get().strMeasure6 : '')}"></li>
        <li th:if="${cocktail.get().strIngredient7 != null and !cocktail.get().strIngredient7.isEmpty()}"
            th:text="${cocktail.get().strIngredient7 + (cocktail.get().strMeasure7 != null and !cocktail.get().strMeasure7.isEmpty() ? ' - ' + cocktail.get().strMeasure7 : '')}"></li>
        <li th:if="${cocktail.get().strIngredient8 != null and !cocktail.get().strIngredient8.isEmpty()}"
            th:text="${cocktail.get().strIngredient8 + (cocktail.get().strMeasure8 != null and !cocktail.get().strMeasure8.isEmpty() ? ' - ' + cocktail.get().strMeasure8 : '')}"></li>
        <li th:if="${cocktail.get().strIngredient9 != null and !cocktail.get().strIngredient9.isEmpty()}"
            th:text="${cocktail.get().strIngredient9 + (cocktail.get().strMeasure9 != null and !cocktail.get().strMeasure9.isEmpty() ? ' - ' + cocktail.get().strMeasure9 : '')}"></li>
        <li th:if="${cocktail.get().strIngredient10 != null and !cocktail.get().strIngredient10.isEmpty()}"
            th:text="${cocktail.get().strIngredient10 + (cocktail.get().strMeasure10 != null and !cocktail.get().strMeasure10.isEmpty() ? ' - ' + cocktail.get().strMeasure10 : '')}"></li>
        <li th:if="${cocktail.get().strIngredient11 != null and !cocktail.get().strIngredient11.isEmpty()}"
            th:text="${cocktail.get().strIngredient11 + (cocktail.get().strMeasure11 != null and !cocktail.get().strMeasure11.isEmpty() ? ' - ' + cocktail.get().strMeasure11 : '')}"></li>
    </ul>

    <h2>제조 방법:</h2>
    <p th:text="${cocktail.get().strInstructions}"></p>

    <p><strong>좋아요 수:</strong> <span th:text="${likeCount}">0</span></p>
</div>

<div th:unless="${cocktail.isPresent()}">
    <p>죄송합니다. 요청하신 칵테일을 찾을 수 없습니다.</p>
</div>

<button class="like-button" id="likeButton"
        th:text="${isLiked ? '좋아요 취소' : '좋아요'}" onClick="likeCocktail()"></button>

<a href="/cocktails/all" class="back-button">목록으로 돌아가기</a>

<script>
    const cocktailId = document.querySelector('.default-cocktail-number').innerText; // 칵테일 번호 가져오기
    const likeButton = document.getElementById('likeButton'); // 버튼 요소 가져오기

    // 좋아요 상태 관리 변수
    let isLiked = /*[[${isLiked}]]*/ false; // 서버에서 받은 좋아요 상태

    function likeCocktail() {
        fetch('/defaultLike', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ "default-cocktail-number": cocktailId }) // 칵테일 이름을 JSON 형태로 전송
        })
            .then(response => {
                if (response.ok) {
                    isLiked = !isLiked; // 좋아요 상태 토글
                    likeButton.innerText = isLiked ? '좋아요 취소' : '좋아요'; // 버튼 텍스트 변경
                    alert(isLiked ? '좋아요 상태가 반영되었습니다!' : '좋아요가 취소되었습니다!');

                    // 페이지 새로 고침
                    setTimeout(() => {
                        location.reload(); // 페이지를 새로 고침하여 최신 좋아요 갯수 표시
                    }, 500); // 0.5초 후에 새로 고침
                } else {
                    alert('좋아요 처리 중 오류가 발생했습니다.');
                    location.reload();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('에러가 발생했습니다.');
            });
    }
</script>
</body>
</html>