<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link th:href="@{/css/fragment/navbar-fragment.css}" rel="stylesheet">
    <link th:href="@{/css/defaultcocktail/defaultcocktaildetail.css}" rel="stylesheet">
    <title th:text="${cocktail.isPresent() ? cocktail.get().strDrink : '칵테일 상세 정보'}">칵테일 상세 정보</title>
</head>
<body>
<div th:replace="~{fragment/navbar-fragment :: navbarFragment}"></div>

<hr class="divider">

<div th:if="${cocktail.isPresent()}" class="cocktail-details">

    <!-- 첫 번째 라운드 사각형: 사진, 제목, 종류, 카테고리, 잔 종류 -->
    <div class="round-rectangle">
        <div class="cocktail-info-container">
            <div class="cocktail-image-container">
                <img th:src="@{${cocktail.get().imagePath}}" th:alt="${cocktail.get().strDrink}" class="cocktail-detail-image">
            </div>
            <div class="cocktail-text-container">
                <h1 th:text="${cocktail.get().strDrink}">칵테일 이름</h1>
                <h1 class="default-cocktail-number" th:text="${cocktail.get().getId()}" style="display: none">칵테일 번호</h1>
                <p><strong>종류:</strong> <span th:text="${cocktail.get().strAlcoholic}"></span></p>
                <p><strong>카테고리:</strong> <span th:text="${cocktail.get().strCategory}"></span></p>
                <p><strong>잔 종류:</strong> <span th:text="${cocktail.get().strGlass}"></span></p>
            </div>
        </div>
    </div>

    <!-- 두 번째 라운드 사각형: 재료 -->
    <div class="round-rectangle">
        <h2>재료</h2>
        <ul class="ingredient-list">
            <li th:if="${cocktail.get().strIngredient1 != null and !cocktail.get().strIngredient1.isEmpty()}"
                th:text="${cocktail.get().strIngredient1 + (cocktail.get().strMeasure1 != null and !cocktail.get().strMeasure1.isEmpty() ? ' - ' + cocktail.get().strMeasure1 : '')}"></li>
            <!-- 추가 재료 목록 -->
        </ul>
    </div>

    <!-- 세 번째 라운드 사각형: 제조 방법 -->
    <div class="round-rectangle">
        <h2>제조 방법</h2>
        <p th:text="${cocktail.get().strInstructions}"></p>
    </div>

    <p><strong>좋아요 수:</strong> <span th:text="${likeCount}">0</span></p>
</div>

<div th:unless="${cocktail.isPresent()}">
    <p>죄송합니다. 요청하신 칵테일을 찾을 수 없습니다.</p>
</div>

<button class="like-button" id="likeButton"
        th:text="${isLiked ? '좋아요 취소' : '좋아요'}" onClick="likeCocktail()"></button>

<a href="/cocktails/all" class="back-button">목록으로 돌아가기</a>

<script>
    const cocktailId = document.querySelector('.default-cocktail-number').innerText;
    const likeButton = document.getElementById('likeButton');

    let isLiked = /*[[${isLiked}]]*/ false;

    function likeCocktail() {
        fetch('/defaultLike', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({"default-cocktail-number": cocktailId})
        })
            .then(response => {
                if (response.ok) {
                    isLiked = !isLiked;
                    likeButton.innerText = isLiked ? '좋아요 취소' : '좋아요';
                    alert(isLiked ? '좋아요 상태가 반영되었습니다!' : '좋아요가 취소되었습니다!');
                    setTimeout(() => { location.reload(); }, 500);
                } else {
                    alert('좋아요 처리 중 오류가 발생했습니다.');
                    location.reload();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('에러가 발생했습니다.');
            });
    }
</script>
</body>
</html>
